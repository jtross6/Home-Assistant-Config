---
#
#  _              _ _   _                
# | |            | | | (_)               
# | |__   ___  __| | |_ _ _ __ ___   ___ 
# | '_ \ / _ \/ _` | __| | '_ ` _ \ / _ \
# | |_) |  __/ (_| | |_| | | | | | |  __/
# |_.__/ \___|\__,_|\__|_|_| |_| |_|\___|
#

- alias: "Bedtime: report"
  trigger:
    - platform: time
      at: input_datetime.bedtime
  condition: "{{ is_state('binary_sensor.bedtime_report', 'on') }}"
  action:
    - service: notify.mobile_app_jordans_iphone
      data:
        title: "Bedtime Status Report"
        message: >
          {{ 'Lights: \n' if is_state('binary_sensor.bedtime_lights_on', 'on') else '' -}}
          {{ expand('group.bedtime_lights') | selectattr('state','eq','on') | list | map(attribute='name') | join('\n') -}}
          Garage: {{ states('cover.garage') }}{{ '\n' -}}
          Front Door: {{ states('lock.front_door') }}
        data:
          push:
            category: BEDTIME

- alias: "Bedtime: good night"
  trigger:
    platform: event
    event_type: ios.notification_action_fired
    event_data:
      actionName: GOOD_NIGHT
  action:
    service: scene.turn_on
    entity_id: scene.good_night